name: Trigger - PR build on comment

env:
  DOCKER_SERVER: registry.knatofs.se
  PULUMI_ACCESS_TOKEN: ${{ secrets.PULUMI_ACCESS_TOKEN }}

on:
  issue_comment:
    types:
      - created

jobs:
  set-vars:
    runs-on: ubuntu-latest
    outputs:
      pr-number: ${{ steps.hard-code.outputs.pr-number }}
    steps:
      - name: hard code
        id: hard-code
        run: echo "pr-number="$(echo "${{ github.event.comment.body }}" | grep -oE '(pr-[0-9]*)') >> $GITHUB_OUTPUT
  call-pr-build:
      needs: set-vars
      if: ${{ startsWith(github.event.comment.body, 'deploy') }}
      uses: ./.github/workflows/pr-build.yaml
      with:
        pr-number: ${{ needs.set-vars.outputs.pr-number }}
        stack-name: ${{ github.event.comment.body }}


